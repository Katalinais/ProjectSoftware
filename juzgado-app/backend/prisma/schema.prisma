generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Status {
  PRIMERA_INSTANCIA
  SEGUNDA_INSTANCIA
  ARCHIVADO
}

model Person {
  id        String   @id @default(uuid())
  name      String
  documentType  String
  document String  @unique

  defendantOf Trial[] @relation("DefendantTrials")
  plaintiffOf Trial[] @relation("PlaintiffTrials")

  @@map("people")
}

model TypeTrial {
  id          String        @id @default(uuid())
  name        String

  categories  Category[]
  trials      Trial[]
  descriptionActions DescriptionAction[]

  @@map("type_trials")
}

model Category {
  id          String   @id @default(uuid())
  description String
  typeTrialId String

  typeTrial   TypeTrial @relation(fields: [typeTrialId], references: [id])
  trials      Trial[]

  @@map("categories")
}

model TypeAction {
  id          String   @id @default(uuid())
  description String

  descriptionActions DescriptionAction[]

  @@map("type_actions")
}

model DescriptionAction {
  id           String   @id @default(uuid())
  description  String
  typeActionId String
  typeTrialId  String?

  typeAction   TypeAction @relation(fields: [typeActionId], references: [id])
  typeTrial    TypeTrial? @relation(fields: [typeTrialId], references: [id])
  actions      Action[]

  @@map("description_actions")
}

model Action {
  id                  String   @id @default(uuid())
  descriptionActionId String
  date                DateTime

  descriptionAction DescriptionAction @relation(fields: [descriptionActionId], references: [id])
  trialId           String?
  trial             Trial? @relation(fields: [trialId], references: [id])

  @@map("actions")
}

model EntryType {
  id          String   @id @default(uuid())
  description String

  trials      Trial[]

  @@map("entry_types")
}

model Trial {
  id           String     @id @default(uuid())
  number       String
  plaintiffId  String
  defendantId  String
  typeTrialId  String
  arrivalDate  DateTime
  closeDate    DateTime?
  status       Status
  categoryId   String?
  entryTypeId  String
  
  category     Category?   @relation(fields: [categoryId], references: [id])
  typeTrial    TypeTrial  @relation(fields: [typeTrialId], references: [id])
  entryType    EntryType  @relation(fields: [entryTypeId], references: [id])

  plaintiff    Person     @relation("PlaintiffTrials", fields: [plaintiffId], references: [id])
  defendant    Person     @relation("DefendantTrials", fields: [defendantId], references: [id])
  actions      Action[]

  @@map("trials")
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  createdAt DateTime @default(now())

  @@map("users")
}
